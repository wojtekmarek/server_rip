<h3>{{viewTitle}}</h3>


<form action="{{action}}" method="POST" autocomplete="off">
  <!-- ustawienie stalego id -->
{{#if addingviaquarters}}
 <label for="IdGraveQuaters">Id Kwatery do pochówku</label>
<select   id="IdGraveQuaters"  disabled name="GraveQuartersnumber" >
  
         <option value='{"_id":"{{GraveQuarters._id}}",
         "id":"{{GraveQuarters.IdGraveQuaters}}","graveenableurn":"{{GraveQuarters.NumberenableUrnBurials}}"
         ,"graveenabletraditional": "{{GraveQuarters.NumberenableTraditionalBurials}}" 
         ,"graveurn":"{{GraveQuarters.NumberUrnBurials}}"
         ,"gravetraditional": "{{GraveQuarters.NumberTraditionalBurials}}"}'>{{GraveQuarters.IdGraveQuaters}}</option>
 
  </select>
  
{{/if}}
  
{{#if addingvianewburial}}
 <label for="IdGraveQuaters">Wybierz Id Kwatery do pochówku</label>
<select   id="IdGraveQuaters" name="GraveQuartersnumber" >
    <option value=''>Wybierz kwatera z listy</option>
  {{#each GraveQuarters}}
         <option value='{"_id":"{{this._id}}"
         ,"id":"{{this.IdGraveQuaters}}"
         ,"graveenableurn":"{{this.NumberenableUrnBurials}}"
         ,"graveenabletraditional": "{{this.NumberenableTraditionalBurials}}" 
         ,"graveurn":"{{this.NumberUrnBurials}}"
         ,"gravetraditional": "{{this.NumberTraditionalBurials}}"}'>{{this.IdGraveQuaters}}</option>
  {{/each}}
  </select>

{{/if}}

<div id="form">




</div>
</form>


<script>
  var idselector=document.getElementById('IdGraveQuaters');
  var burialyrn;
  var selecttypeofgrave="";
  var formdiv = document.getElementById("form");
  var rexdate='^(?:(?:31('+'\\'+"/"+'|-|'+'\\'+"."+')(?:0?[13578]|1[02]))'+'\\'+"1"+'|(?:(?:29|30)('+'\\'+"/"+'|-|'+'\\'+"2"+')(?:0?[13-9]|1[0-2])'+'\\'+"2"+'))(?:(?:1[6-9]|[2-9]'+'\\'+'d)?'+'\\'+'d{2})$|^(?:29('+'\\'+"/"+'|-|'+'\\'+"."+')0?2'+'\\'+"3"+'(?:(?:(?:1[6-9]|[2-9]'+'\\'+'d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1'+'\\'+'d|2[0-8])('+'\\'+"/"+'|-|'+'\\'+"."+')(?:(?:0?[1-9])|(?:1[0-2]))'+'\\'+"4"+'(?:(?:1[6-9]|[2-9]'+'\\'+'d)?'+'\\'+'d{2})$';
  //
  
     var burial={
      "Namedeceased":"",
      "LastNamedeceased":"",
      "DateOfDeath":"",
      "DateBurial":"",
     }
  
 
  //deklaracja zmiany id funkcji 

  //funkcja do pola typu pochówku 
 function settypeofburial(){
    burialyrn=JSON.parse(document.getElementById("IdGraveQuaters").value);
        //console.log(burialyrn);
        //console.log(burialyrn.graveenableurn);
        var graveurn=Number(burialyrn.graveenableurn)-(Number(burialyrn.graveurn));
         var gravetraditional=Number(burialyrn.graveenabletraditional)-(Number(burialyrn.gravetraditional))
        //console.log(graveurn);
       // console.log(gravetraditional);
        if(graveurn==0 )
        {   if(gravetraditional==0 )
             {
                
                 document.getElementById("form").innerHTML="Niestety ta kwatera nie posiada wolnych pochówków";
                 return false;
                
            }else{
      
                selecttypeofgrave=' <label>Rodzaj  pochówku </label>'
                                                                +' <select class="form-control" disabled name="TypeOFburial" placeholder="Tradycyjny"'
                                                                +' value="Tradycyjny">'
                                                                +'<option value="Tradycyjny">Tradycyjny</option>'
                                                                +' </select> </div>'
                                                                 +'<input type="hidden" id="TypeOFburialone" name="TypeOFburialone" value="Tradycyjny">';
                return true;
            }
        }else{if(gravetraditional==0 )
                {
                selecttypeofgrave=' <label>Rodzaj  pochówku </label>'
                                     +' <select class="form-control" disabled name="TypeOFburial" placeholder="Urnowy"'
                                     +' value="Urnowy">'
                                      +'<option value="Urnowy">Urnowy</option>'
                                     +' </select> </div>'
                                     +'<input type="hidden" id="TypeOFburialone" name="TypeOFburialone" value="Urnowy">';
                 return true;

                }else{
                    
                    selecttypeofgrave=' <label>Rodzaj  pochówku </label>'
                                                                +' <select class="form-control"  name="TypeOFburialone" placeholder="Tradycyjny"'
                                                                +' value="Tradycyjny">'
                                                                +'<option value="Urnowy">Urnowy</option>'
                                                                +'<option value="Tradycyjny">Tradycyjny</option>'
                                                                +' </select> </div>';
                   return true;
                }
        }
        
      
 }
 function showform(){
  //alert("pokaż");
  formdiv.innerHTML=' <input type="hidden" id="_idBurial" name="_idBurial" value="'+burialyrn._id.value+'">'
                   // +'<input type="hidden" id="GraveQuaters" name="GraveQuaters" value="'+burialyrn._id+'">'
                    +'<div class="form-group">'
                    +'<label>Imię</label>'
                    +'<input type="text" class="form-control" name="Namedeceased" placeholder="'+burial.Namedeceased+'"'
                    +'value="'+burial.Namedeceased+'" required pattern="[A-Z]{1}[a-z]{2,99}">'
                    +' </div>'
                    +' <div class="form-group">'
                    +'<label>Nazwisko</label>'
                    +'<input type="text" class="form-control" name="LastNamedeceased" placeholder="'+burial.LastNamedeceased+'"'
                    +'value="'+burial.LastNamedeceased+'" required pattern="[A-Z]{1}[a-z]{2,99}">'
                    +'</div>'
                    +selecttypeofgrave
                    +' <div class="form-group">'
                    +'<label>Data śmierci(dzień-miesiąc-rok)</label>'
                    +'<input type="text" class="form-control" name="DateOfDeath"  pattern="'+rexdate+'"'+'placeholder="'+burial.DateOfDeath+'"'
                    +'value="'+burial.DateOfDeath+'" required>'
                    +'</div>'
                    +' <div class="form-group">'
                    +'<label>Data pochówku(dzień-miesiąc-rok)</label>'
                    +'<input type="text" class="form-control" name="DateBurial" pattern="'+rexdate+'"'+'placeholder="'+burial.DateBurial+'" value="'+burial.DateBurial+'" required>'
                    +'</div>'
                    +' <div class="form-group">'
                    +'<button type="submit" class="btn btn-info">Zapisz</button>'
                    +'<a class="btn btn-secondary" href="/burial/list">Pokaz listę</a>'
                    +'</div>';
      
  
 }
    async function changevisibileform(){
     if (settypeofburial())
     {
      showform();
     }
     

    }
       
  
   //sprawdzenie czy wybrane
 
  function checkidselector(){
    if(idselector.value != '')
    {changevisibileform();
    }

  }

  checkidselector();
  //listner do zmiany idselectora
  idselector.addEventListener("change",function(){checkidselector();});
</script>

